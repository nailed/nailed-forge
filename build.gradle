buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        maven {
            name = "forge"
            url = "http://files.minecraftforge.net/maven"
        }
        maven {
            name = "reening"
            url = "http://maven.reening.nl"
        }
    }
    dependencies {
        classpath 'net.minecraftforge.gradle:ForgeGradle:1.0-SNAPSHOT'
        classpath 'jk_5.nailed.gradle:nailed-gradle:1.1-SNAPSHOT'
    }
}

apply plugin: 'java'
apply plugin: 'forge'
//apply plugin: 'nailed'
apply plugin: 'maven'

group = 'jk_5.nailed'
version = '2.0-BETA1'
archivesBaseName = 'nailed-forge'
targetCompatibility = '1.7'
sourceCompatibility = '1.7'

repositories{
    mavenCentral()
    maven {
        name = "forge"
        url = "http://files.minecraftforge.net/maven"
    }
    maven {
        name = "reening"
        url = "http://maven.reening.nl"
    }
    ivy {
        name 'Forge Legacy'
        artifactPattern "http://files.minecraftforge.net/[module]/[module]-dev-[revision].[ext]"
    }
    ivy {
        name 'ChickenBones files'
        artifactPattern "http://www.chickenbones.craftsaddle.org/Files/New_Versions/1.6.4/[module]-dev%20[revision].[ext]"
    }
}

minecraft{
    version = '1.6.4-9.11.1.964'
    assetDir = 'runtime/client/assets'
    accessTransformer = 'src/main/resources/nailed_at.cfg'
}

configurations{
    packed
    compile.extendsFrom packed
    deployerJars
    launcher
}

dependencies {
    packed 'chickenbones:CodeChickenLib:1.6.4-1.0.0.44@jar'
    packed 'pircbot:pircbot:1.5.0'
    packed 'io.netty:netty-all:4.0.14.Final'
    packed files('lib/TeamSpeak3API-r4.jar')

    compile 'org.projectlombok:lombok:1.12.2'

    testCompile 'junit:junit:4.11'

    deployerJars 'org.apache.maven.wagon:wagon-ssh:2.2'

    launcher 'jk_5.nailed:launcher:1.0'
    launcher 'jk_5.nailed.deploy:forge:1.0'
    launcher 'jk_5.nailed.deploy:minecraft:1.0'
    //launcher 'jk_5.nailed:nailed-forge:2.0'
}

/*nailed {
    minecraftVersion = '1.6.4'
/*}

/*nailedInstaller {
    version = '1.0'
}*/

/*nailedLauncher {
    versionName = 'Nailed-2.0'
    mainClass = 'net.minecraft.launchwrapper.Launch'

    loadingMavenUrl = 'http://maven.reening.nl/'
    loadingDependencies = configurations.launcher

    tweakers += 'jk_5.nailed.launcher.UpdatingTweaker'
    tweakers += 'cpw.mods.fml.common.launcher.FMLTweaker'

    remoteProfileDir = 'nailed'

    deployHost = 'maven.reening.nl'
    deployUsername = 'maven'
    deployPassword = mavenPassword
}*/

jar {
    manifest {
        attributes 'FMLCorePlugin': 'jk_5.nailed.coremod.NailedFMLPlugin'
        attributes 'FMLCorePluginContainsFMLMod': 'true'
        attributes 'Version': project.version
    }
    from {
        configurations.packed.collect {
            it.isDirectory() ? it : zipTree(it).matching {
                exclude "META-INF", "META-INF/**", "*META-INF*", "meta-inf"
                exclude "**.jar", "**/*.jar", "*.jar"
            }
        }
    }
    //doLast {
    //    ant.signjar(jar: jar.archivePath, alias: 'Nailed', keystore: nailedKeystoreLocation, storepass: nailedKeystorePassword)
    //}
}

uploadArchives {
    repositories.mavenDeployer {
        configuration = configurations.deployerJars
        repository(url: "scp://maven.reening.nl/media/maven/") {
            authentication(userName: mavenUsername, password: mavenPassword)
        }
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '1.8'
}

processResources {
    from(sourceSets.main.resources.srcDirs) {
        include 'mcmod.info'
        include 'version.properties'
        include '**/**.lang'
        expand 'version': project.version, 'mcversion': project.minecraft.version
    }
    from(sourceSets.main.resources.srcDirs) {
        exclude 'mcmod.info'
        exclude 'version.properties'
        exclude '**/**.lang'
    }
}
