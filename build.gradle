buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        maven {
            name = "forge"
            url = "http://files.minecraftforge.net/maven"
        }
        /*maven {
            name = "reening"
            url = "http://maven.reening.nl"
        }*/
    }
    dependencies {
        classpath 'net.minecraftforge.gradle:ForgeGradle:1.0-SNAPSHOT'
        //classpath 'jk_5.nailed.gradle:nailed-gradle:1.1-SNAPSHOT'
    }
}

apply plugin: 'java'
apply plugin: 'scala'
apply plugin: 'forge'
//apply plugin: 'nailed'
apply plugin: 'maven'
apply plugin: 'idea'

version = '2.0-SNAPSHOT'
archivesBaseName = 'Nailed-Core'

minecraft{
    version = '1.7.2-10.12.0.997'
    assetDir = 'runtime/client/assets'
}

configurations{
    packed
    compile.extendsFrom packed
}

dependencies {
    compile 'org.projectlombok:lombok:1.12.2'

    packed 'pircbot:pircbot:1.5.0'

    testCompile 'junit:junit:4.11'
}

allprojects {
    sourceCompatibility = '1.6'
    targetCompatibility = '1.6'

    ext.ats = []

    jar {
        from {
            configurations.packed.collect {
                it.isDirectory() ? it : zipTree(it).matching {
                    exclude "META-INF", "META-INF/**", "*META-INF*", "meta-inf"
                    exclude "**.jar", "**/*.jar", "*.jar"
                }
            }
        }

        manifest {
            attributes 'version': project.version
            attributes 'mcversion': rootProject.minecraft.version
        }
    }

    repositories {
        mavenLocal()
        mavenCentral()
        maven {
            name 'forge'
            url 'http://files.minecraftforge.net/maven'
        }
        maven {
            name "minecraft"
            url "https://libraries.minecraft.net/"
        }
        /*maven {
            name = "reening"
            url = "http://maven.reening.nl/"
        }*/
    }

    sourceSets.main.resources.getFiles().each { file ->
        if (file.getName().endsWith(".at") || file.getName().endsWith("_at.cfg")){
            ats += file.getName();
            rootProject.minecraft.at file.getPath()
        }
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'scala'

    jar {
        baseName = 'Nailed-' + baseName
        destinationDir = new File(rootProject.getBuildDir(), 'libs')
    }

    configurations{
        packed
        compile.extendsFrom packed
    }

    dependencies {
        compile rootProject
        compile 'org.projectlombok:lombok:1.12.2'

        testCompile 'junit:junit:4.11'
    }

    rootProject.tasks.reobf {
        reobf(tasks.jar) { spec ->
            spec.classpath = sourceSets.main.compileClasspath
        }
    }
}
